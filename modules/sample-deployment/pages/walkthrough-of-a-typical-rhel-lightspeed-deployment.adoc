#  Walkthrough of a typical RHEL Lightspeed deployment

This section provides a comprehensive walkthrough of a typical RHEL Lightspeed deployment, focusing on how RHEL systems integrate with Red Hat Insights to leverage Lightspeed's AI-powered recommendations. We'll detail the technical steps involved and provide a hands-on lab to solidify your understanding.

[NOTE]
RHEL Lightspeed is not a standalone product you install. Instead, it's an AI service that enhances the capabilities of Red Hat Insights, providing more relevant and contextualized recommendations based on your RHEL environment. The "deployment" of RHEL Lightspeed, therefore, primarily involves ensuring your RHEL systems are correctly configured to report to Red Hat Insights.

== Understanding the RHEL Lightspeed Integration Model

Before diving into the steps, it's crucial to understand the architectural flow:

.  *RHEL System with `insights-client`*: Your RHEL server or workstation runs the `insights-client` package. This client is responsible for collecting configuration, performance, and log data from your system.
.  *Data Upload to Red Hat Insights*: The `insights-client` securely uploads the collected data to the Red Hat Insights cloud platform. This platform acts as a central repository for all your registered RHEL systems' data.
.  *Red Hat Insights Analysis*: The Insights platform performs a deep analysis of the uploaded data, identifying potential issues, vulnerabilities, and optimization opportunities.
.  *Lightspeed AI Enhancement*: When Lightspeed is enabled for your Insights account, its AI engine processes the data and Insights' findings. It uses large language models (LLMs) to generate more human-readable, context-aware, and actionable remediation recommendations, often including specific `ansible-playbook` snippets.
.  *Recommendations in Hybrid Cloud Console*: The Lightspeed-enhanced recommendations are then presented to you in the Red Hat Hybrid Cloud Console (console.redhat.com), specifically within the Insights Advisor service.

This client-server model ensures that the powerful AI capabilities of Lightspeed are delivered as a service, without requiring complex local installations on each RHEL system.

== Typical Deployment Stages for RHEL Lightspeed Integration

A typical deployment of RHEL Lightspeed capabilities involves the following stages:

.  *System Preparation*: Ensure your RHEL system meets the basic requirements for connecting to Red Hat Insights.
.  *Red Hat Subscription Management (RHSM) Registration*: Register your RHEL system with RHSM to ensure it has valid entitlements and access to Red Hat repositories. This is a prerequisite for `insights-client` functionality.
.  *Insights Client Installation and Configuration*: Install and configure the `insights-client` package on your RHEL system. This establishes the connection to the Red Hat Insights platform.
.  *Data Collection and Upload*: The `insights-client` automatically collects data periodically and uploads it to Red Hat Insights. You can also trigger manual uploads for immediate analysis.
.  *Lightspeed Integration & Recommendation Generation*: (This stage occurs on the Red Hat cloud side). Once data is processed by Insights, Lightspeed's AI engine analyzes the findings to generate enriched recommendations.
.  *Reviewing Lightspeed Recommendations*: Access the Red Hat Hybrid Cloud Console to view and act on the AI-powered recommendations provided by Lightspeed within the Insights Advisor service.

== Detailed Walkthrough: Integrating RHEL with Lightspeed Insights

Let's walk through the process of preparing a RHEL system to leverage RHEL Lightspeed capabilities.

=== 1. Prerequisites Check

Before you begin, ensure the following prerequisites are met for your RHEL system:

*   **Supported RHEL Version**: RHEL 8 or 9 (or later) is generally required for full Insights and Lightspeed functionality.
*   **Network Connectivity**: The RHEL system must have outbound internet access to `console.redhat.com` (or specific Insights endpoints) over HTTPS (port 443).
*   **Red Hat Subscription**: A valid Red Hat subscription (e.g., RHEL, Developer Subscription) associated with your Red Hat account.
*   **Red Hat Account**: Access to a Red Hat user account (login to `console.redhat.com`).

=== 2. Registering with Red Hat Subscription Management (RHSM)

Your RHEL system must be registered with RHSM to obtain necessary entitlements and repository access, which `insights-client` relies on.

.  Log in to your RHEL system as a user with `sudo` privileges.
.  Register the system with your Red Hat account:
+
[source,bash]
----
sudo subscription-manager register --username=<YOUR_REDHAT_USERNAME> --password=<YOUR_REDHAT_PASSWORD> --auto-attach
----
+
[TIP]
If you are using an activation key, you can register with:
`sudo subscription-manager register --org=<ORG_ID> --activationkey=<ACTIVATION_KEY>`
You can find your `ORG_ID` and create `ACTIVATION_KEY` in the Red Hat Hybrid Cloud Console under *Settings* -> *Activation Keys*.

.  Verify the subscription status:
+
[source,bash]
----
sudo subscription-manager status
sudo subscription-manager list --consumed
----
+
You should see "Overall Status: Current" and a valid subscription listed.

=== 3. Installing and Configuring the `insights-client`

The `insights-client` package is the bridge between your RHEL system and Red Hat Insights.

.  **Install `insights-client`**:
+
[source,bash]
----
sudo dnf install -y insights-client
----

.  **Register `insights-client` and Perform Initial Upload**:
+
This command registers the client with the Insights platform and immediately performs an initial data collection and upload.
+
[source,bash]
----
sudo insights-client --register
----
+
You will see output indicating data collection and upload progress.

.  **Verify `insights-client` Status**:
+
The `insights-client` is designed to run automatically. You can check its service status:
+
[source,bash]
----
sudo systemctl status insights-client
----
+
It should show as `active (running)`.

=== 4. Data Collection and Upload

After initial registration, `insights-client` typically runs daily to collect and upload new data.

*   To force an immediate data upload for testing or troubleshooting, you can run:
+
[source,bash]
----
sudo insights-client --upload
----

=== 5. Accessing Red Hat Hybrid Cloud Console and Reviewing Recommendations

Once your RHEL system has successfully uploaded data, you can access the Red Hat Hybrid Cloud Console to view the insights and recommendations, including those enhanced by Lightspeed.

.  Open your web browser and navigate to: link:https://console.redhat.com[https://console.redhat.com]
.  Log in with your Red Hat account credentials.
.  From the console's navigation menu, select *Insights* -> *RHEL* -> *Inventory*. You should see your newly registered RHEL system listed. It might take a few minutes for the system to appear after its first upload.
.  Click on your system's hostname to view its details.
.  Navigate to the *Advisor* service (under *Services* in the left-hand menu within the RHEL Insights dashboard).
.  Here, you will see recommendations generated by Red Hat Insights. Look for indicators or labels that denote recommendations powered by RHEL Lightspeed. These recommendations will typically be more detailed, human-readable, and often include concrete `ansible-playbook` suggestions for remediation.

[TIP]
The presence of Lightspeed-powered recommendations depends on the types of issues identified on your system and the active integrations within your Insights account. While we cannot guarantee a specific Lightspeed recommendation will appear immediately on a newly registered system, the *location* where you would find them is within the Insights Advisor.

=== Troubleshooting Common Issues

*   **`subscription-manager` registration failure**:
    *   Check your username and password.
    *   Ensure network connectivity to Red Hat's subscription services.
    *   Verify your Red Hat account has an active subscription.
*   **`insights-client` registration or upload failure**:
    *   Check the `/var/log/insights-client/insights-client.log` for errors.
    *   Ensure the system is correctly registered with `subscription-manager`.
    *   Verify network connectivity to `console.redhat.com`.
    *   Check firewall rules if outbound connections are restricted.
*   **System not appearing in Red Hat Hybrid Cloud Console**:
    *   Allow up to 30 minutes after the first `insights-client --register` or `insights-client --upload` for the system to appear.
    *   Verify that the `insights-client` service is running (`sudo systemctl status insights-client`).
    *   Check the `insights-client` logs for any upload errors.
*   **No Lightspeed-specific recommendations**:
    *   Ensure you are looking in the Insights Advisor service.
    *   Lightspeed provides *enhanced* recommendations for *existing* Insights findings. If your system has no significant issues, there might not be any recommendations.
    *   Lightspeed might be a feature that needs to be explicitly enabled or is part of a specific subscription tier for your Red Hat account. Refer to Red Hat's official documentation for any specific Lightspeed enablement steps.

== Hands-on Lab: Preparing a RHEL System for Lightspeed Insights

This lab guides you through the process of preparing a RHEL system to connect with Red Hat Insights, thereby making it ready to receive Lightspeed-enhanced recommendations.

=== Lab Goal

To successfully register a RHEL 8 or 9 system with Red Hat Subscription Management and Red Hat Insights, verify its presence in the Hybrid Cloud Console, and identify where Lightspeed-powered recommendations would appear.

=== Scenario

You are tasked with integrating a newly provisioned RHEL server into your organization's Red Hat Insights platform to leverage AI-powered operational recommendations provided by RHEL Lightspeed.

=== Prerequisites for Lab

*   A running **Red Hat Enterprise Linux 8 or 9** virtual machine (VM) or physical server.
*   The RHEL system must have **internet access**.
*   A **Red Hat user account** with an active RHEL subscription.
*   **Root or `sudo` privileges** on the RHEL system.

=== Lab Steps

.  **Step 1: Verify RHEL System Readiness**

    *   Log in to your RHEL system (e.g., via SSH or console).
    *   Verify internet connectivity:
        +
        [source,bash]
        ----
        ping -c 3 google.com
        ----
        +
        Ensure you receive responses. If not, troubleshoot network configuration (DNS, gateway, firewall).
    *   Check the RHEL version:
        +
        [source,bash]
        ----
        cat /etc/redhat-release
        ----
        +
        Confirm it's RHEL 8 or 9.

.  **Step 2: Register with Red Hat Subscription Management (RHSM)**

    *   Use your Red Hat account credentials to register the system:
        +
        [source,bash]
        ----
        sudo subscription-manager register --username=<YOUR_REDHAT_USERNAME> --password=<YOUR_REDHAT_PASSWORD> --auto-attach
        ----
        +
        Replace `<YOUR_REDHAT_USERNAME>` and `<YOUR_REDHAT_PASSWORD>` with your actual Red Hat credentials.
        +
        [NOTE]
        If you encounter `NetworkManager is not running.`, restart it: `sudo systemctl restart NetworkManager`.
    *   Verify successful registration:
        +
        [source,bash]
        ----
        sudo subscription-manager status
        ----
        +
        The "Overall Status" should be `Current`.

.  **Step 3: Install the `insights-client` Package**

    *   Install the client:
        +
        [source,bash]
        ----
        sudo dnf install -y insights-client
        ----

.  **Step 4: Register `insights-client` and Perform Initial Upload**

    *   This command registers the client with Red Hat Insights and initiates the first data collection and upload.
        +
        [source,bash]
        ----
        sudo insights-client --register
        ----
    *   Wait for the process to complete. You'll see output indicating data collection and upload status.

.  **Step 5: Verify `insights-client` Service Status**

    *   Check if the `insights-client` service is running:
        +
        [source,bash]
        ----
        sudo systemctl status insights-client
        ----
        +
        It should show `active (running)`. If not, start it with `sudo systemctl start insights-client`.

.  **Step 6: Access Red Hat Hybrid Cloud Console**

    *   Open your web browser and navigate to: link:https://console.redhat.com[https://console.redhat.com]
    *   Log in with the same Red Hat account you used for `subscription-manager` registration.

.  **Step 7: Verify System in Insights Inventory**

    *   From the main navigation, go to *Insights* -> *RHEL* -> *Inventory*.
    *   Look for your RHEL system's hostname in the list. It might take a few minutes (up to 30) for it to appear after the initial upload. Refresh the page if needed.
    *   Click on your system's hostname to view its overview page.

.  **Step 8: Explore Insights Advisor for Lightspeed Recommendations**

    *   On your system's overview page within the Hybrid Cloud Console, navigate to the *Advisor* service (usually found in the left-hand menu under *Services*).
    *   Review the recommendations listed.
        +
        [TIP]
        While a new system might not immediately show Lightspeed-specific recommendations, this is the area where they would appear. Look for indicators such as "Lightspeed" badges or explicitly AI-generated remediation playbooks. As your system runs and gathers more data, and if it encounters common issues, Lightspeed-enhanced recommendations become more likely to surface.

=== Lab Verification

*   Your RHEL system successfully registered with Red Hat Subscription Management.
*   The `insights-client` is installed, registered, and running on your RHEL system.
*   Your RHEL system's hostname appears in the Red Hat Hybrid Cloud Console under *Insights* -> *RHEL* -> *Inventory*.
*   You have navigated to the *Advisor* service within the console and understand where Lightspeed-powered recommendations would be presented.#  Walkthrough of a typical RHEL Lightspeed deployment

```
== Walkthrough of a Typical RHEL Lightspeed Deployment

In this section, we will walk through a typical deployment of RHEL Lightspeed. This hands-on lab activity will guide you through the process of setting up RHEL Lightspeed in a controlled environment.

### Prerequisites

Before you begin the deployment, ensure you have the following:

- A Red Hat Enterprise Linux (RHEL) server with a valid subscription.
- A Red Hat account with appropriate permissions to access the RHEL Lightspeed service.
- Basic understanding of RHEL system administration.

### Step-by-Step Deployment Guide

#### Step 1: Register the RHEL System

First, register your RHEL system to the Red Hat Subscription Manager (RHSM) if it isn't already registered. This can be done using the following command:

```bash
subscription-manager register --username <username> --password <password>
```

Replace `<username>` and `<password>` with your Red Hat account credentials.

#### Step 2: Attach the RHEL Lightspeed Subscription

Next, attach the RHEL Lightspeed subscription to your system:

```bash
subscription-manager attach --auto
```

#### Step 3: Install RHEL Lightspeed

Now, install the RHEL Lightspeed package using the following command:

```bash
dnf install -y redhat-insights-client
```

#### Step 4: Configure RHEL Lightspeed

After installation, configure RHEL Lightspeed by editing the configuration file:

```bash
vi /etc/insights-client/insights-client.conf
```

Ensure the following lines are present and uncommented:

```
[insights]
organization=<your-organization-id>
prefix=<your-prefix>
```

Replace `<your-organization-id>` and `<your-prefix>` with your actual organization ID and prefix, which you can find in the Red Hat Customer Portal.

#### Step 5: Start and Enable the RHEL Lightspeed Service

Start and enable the RHEL Lightspeed service with the following commands:

```bash
systemctl start insights-client
systemctl enable insights-client
```

#### Step 6: Verify the Installation

Finally, verify that RHEL Lightspeed is installed and